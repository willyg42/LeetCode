SELECT CUSTOMER_ID, COUNT(VISITS.VISIT_ID) count_no_trans FROM VISITS LEFT JOIN TRANSACTIONS ON VISITS.VISIT_ID = TRANSACTIONS.VISIT_ID WHERE TRANSACTION_ID is null GROUP BY CUSTOMER_ID